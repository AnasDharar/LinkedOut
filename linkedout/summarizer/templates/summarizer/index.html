<!DOCTYPE html>
<html>
<head>
    <title>LinkedOut</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-10">
    <div class="max-w-3xl mx-auto bg-white p-6 rounded-2xl shadow">
        <h1 class="text-2xl font-bold mb-4 text-center">LinkedOut ðŸ§ </h1>

        <form id="summarizeForm" class="flex gap-2 mb-6">
            {% csrf_token %}
            <input id="urlInput" type="url" name="url" placeholder="Paste LinkedIn post URL" required
                   class="flex-1 border border-gray-300 p-2 rounded">
            <button type="submit" id="submitBtn" class="bg-blue-500 text-white px-4 py-2 rounded">
                Summarize
            </button>
        </form>

        <div id="loader" class="hidden text-center text-gray-500 mb-4">Summarizing...</div>

        <div id="result" class="hidden space-y-4">
            <p><strong>Author:</strong> <span id="author"></span></p>
            <p><strong>Summary:</strong></p>
            <p id="summary" class="bg-blue-50 p-3 rounded"></p>
            <p><strong>Post URL:</strong> <a id="post-url" class="text-blue-500">Click to view</a></p>
            <p><strong>Original Text:</strong></p>
            <p id="text" class="whitespace-pre-line bg-gray-50 p-3 rounded"></p>
        </div>
    </div>

    <script>
        const form = document.getElementById("summarizeForm");
        const loader = document.getElementById("loader");
        const result = document.getElementById("result");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            result.classList.add("hidden");
            loader.classList.remove("hidden");

            const url = document.getElementById("urlInput").value;
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            const response = await fetch("/summarize/", {
                method: "POST",
                headers: {
                    "X-CSRFToken": csrfToken,
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({ url })
            });

            loader.classList.add("hidden");

            if (response.ok) {
                const data = await response.json();
                document.getElementById("author").textContent = data.author || "Unknown";
                document.getElementById("text").textContent = data.text || "No text found.";
                document.getElementById("summary").textContent = data.summary || "No summary generated.";
                document.getElementById("post-url").href = url || "N/A";
                result.classList.remove("hidden");
            } else {
                alert("Error summarizing post. Try again.");
            }
        });
    </script>
</body>
</html>
